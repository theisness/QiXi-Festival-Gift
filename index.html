<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ƒå¤•ç‰¹åˆ«ç¤¼ç‰©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        love: {
                            pink: '#FF6B8B',
                            red: '#FF3366',
                            purple: '#C955E8',
                            blue: '#6A8FFF'
                        }
                    },
                    fontFamily: {
                        romantic: ['Dancing Script', 'cursive', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 0 2px 10px rgba(255, 51, 102, 0.5);
            }
            .heart-beat {
                animation: heartbeat 1.5s ease-in-out infinite;
            }
            .float {
                animation: float 6s ease-in-out infinite;
            }
            .glow {
                filter: drop-shadow(0 0 8px rgba(255, 107, 139, 0.8));
            }
            .music-control {
                animation: musicPulse 2s ease-in-out infinite;
            }
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.1); }
            28% { transform: scale(1); }
            42% { transform: scale(1.1); }
            70% { transform: scale(1); }
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }

        @keyframes musicPulse {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        .heart {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
            will-change: transform, opacity;
        }

        .firework {
            position: absolute;
            pointer-events: none;
            z-index: 50;
        }

        .firework-particle {
            position: absolute;
            border-radius: 50%;
            will-change: transform, opacity;
        }

        .message-appear {
            animation: messageAppear 3s ease-out forwards;
        }

        @keyframes messageAppear {
            0% { 
                opacity: 0;
                transform: translateY(50px) scale(0.8);
                filter: blur(10px);
            }
            100% { 
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: blur(0);
            }
        }

        .color-transition {
            animation: colorTransition 15s ease-in-out infinite;
        }

        @keyframes colorTransition {
            0% { background-color: #FFF0F5; }
            25% { background-color: #FFF5FA; }
            50% { background-color: #F0F7FF; }
            75% { background-color: #F5F0FF; }
            100% { background-color: #FFF0F5; }
        }

        @keyframes blessingFloat {
            0% { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            20% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.1);
            }
            100% { 
                opacity: 0;
                transform: translate(-50%, -100px) scale(1);
            }
        }

        .message-bg {
            background-image: url('2.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }

        .message-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 50%, rgba(255, 255, 255, 0.5) 100%);
            border-radius: 1rem;
        }

        .message-content {
            position: relative;
            z-index: 1;
        }

        .message-bg {
            transition: background-image 0.5s ease-in-out;
        }

        .carousel-indicator {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 2;
        }

        .carousel-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .carousel-dot.active {
            background-color: rgba(255, 255, 255, 0.9);
            transform: scale(1.2);
        }

        .music-player {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(255, 107, 139, 0.3);
            border: 2px solid rgba(255, 107, 139, 0.2);
            transition: all 0.3s ease;
        }

        .music-player:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(255, 107, 139, 0.4);
        }

        .music-player.playing {
            animation: musicGlow 2s ease-in-out infinite;
        }

        @keyframes musicGlow {
            0%, 100% { box-shadow: 0 8px 32px rgba(255, 107, 139, 0.3); }
            50% { box-shadow: 0 8px 32px rgba(255, 107, 139, 0.6), 0 0 20px rgba(255, 107, 139, 0.4); }
        }

        .music-control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF6B8B, #C955E8);
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .music-control-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 107, 139, 0.6);
        }

        .music-control-btn.playing {
            background: linear-gradient(135deg, #FF3366, #6A8FFF);
            animation: musicPulse 2s ease-in-out infinite;
        }

        .music-visualizer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            margin-top: 8px;
        }

        .music-bar {
            width: 3px;
            height: 15px;
            background: linear-gradient(to top, #FF6B8B, #C955E8);
            border-radius: 2px;
            animation: musicBar 1.5s ease-in-out infinite;
        }

        .music-bar:nth-child(1) { animation-delay: 0s; }
        .music-bar:nth-child(2) { animation-delay: 0.1s; }
        .music-bar:nth-child(3) { animation-delay: 0.2s; }
        .music-bar:nth-child(4) { animation-delay: 0.3s; }
        .music-bar:nth-child(5) { animation-delay: 0.4s; }

        @keyframes musicBar {
            0%, 100% { height: 15px; opacity: 0.6; }
            50% { height: 25px; opacity: 1; }
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                transform: translate3d(0, -8px, 0);
            }
            70% {
                transform: translate3d(0, -4px, 0);
            }
            90% {
                transform: translate3d(0, -2px, 0);
            }
        }

        /* åŠ è½½ç•Œé¢æ ·å¼ */
        #loading-screen {
            transition: all 0.3s ease-in-out;
        }

        #progress-bar {
            background: linear-gradient(90deg, #FF6B8B, #C955E8, #6A8FFF);
            background-size: 200% 100%;
            animation: progressGlow 2s ease-in-out infinite;
        }

        @keyframes progressGlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .loading-heart {
            animation: loadingHeartbeat 1.2s ease-in-out infinite;
        }

        @keyframes loadingHeartbeat {
            0%, 100% { 
                transform: scale(1) rotate(0deg); 
                filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.8));
            }
            50% { 
                transform: scale(1.1) rotate(5deg); 
                filter: drop-shadow(0 0 30px rgba(255, 255, 255, 1));
            }
        }

        .volume-control {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            border-radius: 2px;
            background: rgba(255, 107, 139, 0.3);
            outline: none;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #FF6B8B;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #FF6B8B;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="min-h-screen color-transition overflow-hidden relative">
    <!-- åŠ è½½ç•Œé¢ -->
    <div id="loading-screen" class="fixed inset-0 z-[9999] bg-gradient-to-br from-love-pink via-love-purple to-love-blue flex flex-col items-center justify-center">
        <div class="text-center">
            <!-- åŠ è½½åŠ¨ç”» -->
            <div class="mb-8">
                <div class="loading-heart text-white text-8xl mb-4">
                    <i class="fa fa-heart"></i>
                </div>
                <h1 class="font-romantic text-white text-3xl font-bold mb-2">ä¸ƒå¤•ç‰¹åˆ«ç¤¼ç‰©</h1>
                <p class="text-white/80 text-lg">æ­£åœ¨å‡†å¤‡æµªæ¼«æ—¶å…‰...</p>
            </div>
            
            <!-- è¿›åº¦æ¡å®¹å™¨ -->
            <div class="w-80 bg-white/20 rounded-full h-3 mb-4 overflow-hidden backdrop-blur-sm">
                <div id="progress-bar" class="h-full rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
            </div>
            
            <!-- è¿›åº¦æ–‡æœ¬ -->
            <div class="text-white/90 font-medium">
                <span id="progress-text">0%</span>
                <span class="ml-2">èµ„æºåŠ è½½ä¸­...</span>
            </div>
            
            <!-- åŠ è½½è¯¦æƒ… -->
            <div id="loading-details" class="mt-6 text-white/70 text-sm bg-white/10 backdrop-blur-sm rounded-lg p-4">
                <div class="flex items-center justify-between mb-3">
                    <span class="flex items-center">
                        <i class="fa fa-image mr-2 text-love-pink"></i>
                        å›¾ç‰‡èµ„æº
                    </span>
                    <span id="image-progress" class="text-love-pink font-bold">0/7</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="flex items-center">
                        <i class="fa fa-music mr-2 text-love-pink"></i>
                        éŸ³ä¹èµ„æº
                    </span>
                    <span id="music-progress" class="text-love-pink font-bold">0/4</span>
                </div>
                <!-- è·³è¿‡åŠ è½½æŒ‰é’® -->
                <div class="mt-4 text-center">
                    <button id="skip-loading" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-full text-sm transition-colors duration-300">
                        <i class="fa fa-forward mr-2"></i>è·³è¿‡åŠ è½½
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- éŸ³ä¹æ’­æ”¾å™¨ -->
    <div class="music-player">
        <div class="flex items-center gap-3">
            <button id="music-toggle" class="music-control-btn" title="æ’­æ”¾/æš‚åœéŸ³ä¹">
                <i class="fa fa-play"></i>
            </button>
            <button id="music-next" class="music-control-btn" style="width: 40px; height: 40px; font-size: 16px;" title="ä¸‹ä¸€é¦–éŸ³ä¹">
                <i class="fa fa-forward"></i>
            </button>
        </div>
        <div class="volume-control">
            <i class="fa fa-volume-up text-love-pink text-sm"></i>
            <input type="range" id="volume-slider" class="volume-slider" min="0" max="100" value="50" title="éŸ³é‡æ§åˆ¶">
        </div>
        <div class="mt-2 text-center">
            <span id="music-title" class="text-xs text-love-pink font-medium">Little temper</span>
        </div>
        <div class="music-visualizer">
            <div class="music-bar"></div>
            <div class="music-bar"></div>
            <div class="music-bar"></div>
            <div class="music-bar"></div>
            <div class="music-bar"></div>
        </div>
    </div>

    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="bg-music" loop preload="auto">
        <source src="1.mp3" type="audio/wav">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
    </audio>

    <!-- å¤‡ç”¨æµªæ¼«éŸ³ä¹ -->
    <audio id="romantic-music-1" loop preload="auto">
        <source src="2.mp3" type="audio/wav">
    </audio>
    
    <audio id="romantic-music-2" loop preload="auto">
        <source src="3.mp3" type="audio/wav">
    </audio>
    
    <audio id="romantic-music-3" loop preload="auto">
        <source src="4.mp3" type="audio/wav">
    </audio>

    <!-- èƒŒæ™¯è£…é¥° -->
    <div class="fixed inset-0 z-0 opacity-20">
        <div class="absolute top-10 left-10 text-love-pink text-6xl heart-beat">
            <i class="fa fa-heart"></i>
        </div>
        <div class="absolute top-20 right-20 text-love-red text-5xl heart-beat" style="animation-delay: 0.3s">
            <i class="fa fa-heart"></i>
        </div>
        <div class="absolute bottom-40 left-20 text-love-purple text-4xl heart-beat" style="animation-delay: 0.6s">
            <i class="fa fa-heart"></i>
        </div>
        <div class="absolute bottom-20 right-40 text-love-blue text-5xl heart-beat" style="animation-delay: 0.9s">
            <i class="fa fa-heart"></i>
        </div>
    </div>

    <!-- æ˜Ÿæ˜Ÿè£…é¥° -->
    <div id="stars" class="fixed inset-0 z-0 pointer-events-none"></div>

    <!-- æ¸¸æˆæ ‡é¢˜ -->
    <div class="relative z-10 text-center pt-10 md:pt-20">
        <h1 class="font-romantic text-[clamp(2rem,5vw,3.5rem)] text-love-red font-bold text-shadow float">
            ç»™å¤«äººçš„ä¸ƒå¤•å¿ƒåŠ¨æŒ‘æˆ˜
        </h1>
        <p class="mt-4 text-gray-700 font-romantic text-[clamp(1.2rem,3vw,1.8rem)]">
            ç‚¹å‡»é£˜è½çš„çˆ±å¿ƒï¼Œæ”¶é›†7é¢—å¿ƒåŠ¨
        </p>
        <div class="mt-6 flex justify-center gap-2" id="progress-container">
            <!-- è¿›åº¦æŒ‡ç¤ºå™¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- çˆ±å¿ƒå®¹å™¨ -->
    <div id="hearts-container" class="relative w-full h-[60vh] overflow-hidden"></div>

    <!-- ç¥ç¦ä¿¡æ¯ (é»˜è®¤éšè—) -->
    <div id="message" class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-1000">
        <div class="message-bg rounded-2xl p-8 md:p-12 max-w-2xl w-full mx-4 transform scale-95 transition-transform duration-1000 message-appear">
            <div class="message-content text-center">
                <div class="flex justify-center mb-6">
                    <i class="fa fa-heart text-love-red text-5xl heart-beat"></i>
                </div>
                <h2 class="font-romantic text-[clamp(1.8rem,4vw,2.5rem)] text-love-purple mb-4">äº²çˆ±çš„å®è´</h2>
                <p class="font-romantic text-[clamp(1.2rem,3vw,1.6rem)] text-gray-700 leading-relaxed mb-6">
                    ä¸ƒå¤•å¿«ä¹ï¼<br>
                    æ„Ÿè°¢ä½ å‡ºç°åœ¨æˆ‘çš„ç”Ÿå‘½é‡Œï¼Œ<br>
                    æ¯ä¸€å¤©æœ‰ä½ çš„é™ªä¼´éƒ½æ˜¯å¹¸ç¦çš„ã€‚<br>
                    æ„¿æˆ‘ä»¬æ°¸è¿œåƒå¤©ä¸Šçš„ç‰›éƒç»‡å¥³ï¼Œ<br>
                    æˆ‘çˆ±ä½ ï¼Œä¸æ­¢ä¸ƒå¤•ï¼Œè€Œæ˜¯æœæœå¤•å¤•ã€‚
                </p>
                <div class="mt-8">
                    <button id="restart-btn" class="bg-love-pink hover:bg-love-red text-white font-romantic text-xl py-3 px-8 rounded-full transition-colors duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-transform">
                        å†ç©ä¸€æ¬¡
                    </button>
                </div>
            </div>
            
            <!-- è½®æ’­æŒ‡ç¤ºå™¨ -->
            <div class="carousel-indicator">
                <div class="carousel-dot active" data-index="0"></div>
                <div class="carousel-dot" data-index="1"></div>
                <div class="carousel-dot" data-index="2"></div>
                <div class="carousel-dot" data-index="3"></div>
                <div class="carousel-dot" data-index="4"></div>
                <div class="carousel-dot" data-index="5"></div>
                <div class="carousel-dot" data-index="6"></div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            score: 0,
            requiredScore: 7,
            isPlaying: true,
            hearts: [],
            animationFrameId: null
        };

        // DOM å…ƒç´ 
        const heartsContainer = document.getElementById('hearts-container');
        const progressContainer = document.getElementById('progress-container');
        const message = document.getElementById('message');
        const restartBtn = document.getElementById('restart-btn');
        const starsContainer = document.getElementById('stars');
        const musicToggleBtn = document.getElementById('music-toggle');
        const musicNextBtn = document.getElementById('music-next');
        const volumeSlider = document.getElementById('volume-slider');
        const bgMusic = document.getElementById('bg-music');
        const musicTitle = document.getElementById('music-title');
        const loadingScreen = document.getElementById('loading-screen');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const loadingDetails = document.getElementById('loading-details');
        const imageProgress = document.getElementById('image-progress');
        const musicProgress = document.getElementById('music-progress');
        const skipLoadingBtn = document.getElementById('skip-loading');

        // éŸ³ä¹æ§åˆ¶çŠ¶æ€
        let isMusicPlaying = false;
        let currentMusicIndex = 0;
        let hasShownMusicTip = false;

        // èµ„æºåŠ è½½çŠ¶æ€
        let loadedImages = 0;
        let loadedMusic = 0;
        let totalImages = 7;
        let totalMusic = 4;
        let isAllResourcesLoaded = false;

        // éŸ³ä¹åˆ—è¡¨
        const musicList = [
            { id: 'bg-music', title: 'Little temper', element: null },
            { id: 'romantic-music-1', title: 'Love paradise', element: null },
            { id: 'romantic-music-2', title: 'A thousand miles', element: null },
            { id: 'romantic-music-3', title: 'Serenade In C,Op.48', element: null }
        ];

        // å›¾ç‰‡æ–‡ä»¶åˆ—è¡¨
        const imageFiles = ['1.jpg', '2.jpg', '3.jpg', '4.jpg', '5.jpg', '6.jpg', '7.jpg'];

        // é¢„åŠ è½½å›¾ç‰‡
        function preloadImages() {
            console.log('å¼€å§‹é¢„åŠ è½½å›¾ç‰‡...');
            const promises = imageFiles.map((imageFile, index) => {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    
                    // è®¾ç½®è¶…æ—¶
                    const timeout = setTimeout(() => {
                        console.warn(`å›¾ç‰‡åŠ è½½è¶…æ—¶: ${imageFile}`);
                        loadedImages++;
                        updateLoadingProgress();
                        resolve(null);
                    }, 10000); // 10ç§’è¶…æ—¶
                    
                    img.onload = () => {
                        clearTimeout(timeout);
                        console.log(`å›¾ç‰‡åŠ è½½æˆåŠŸ: ${imageFile}`);
                        loadedImages++;
                        updateLoadingProgress();
                        resolve(img);
                    };
                    img.onerror = () => {
                        clearTimeout(timeout);
                        console.warn(`å›¾ç‰‡åŠ è½½å¤±è´¥: ${imageFile}`);
                        loadedImages++;
                        updateLoadingProgress();
                        resolve(null); // å³ä½¿å¤±è´¥ä¹Ÿç»§ç»­
                    };
                    img.src = imageFile;
                });
            });
            return Promise.all(promises);
        }

        // é¢„åŠ è½½éŸ³ä¹
        function preloadMusic() {
            console.log('å¼€å§‹é¢„åŠ è½½éŸ³ä¹...');
            const promises = musicList.map((music, index) => {
                return new Promise((resolve, reject) => {
                    const audio = document.getElementById(music.id);
                    if (audio) {
                        // è®¾ç½®è¶…æ—¶
                        const timeout = setTimeout(() => {
                            console.warn(`éŸ³ä¹åŠ è½½è¶…æ—¶: ${music.title}`);
                            loadedMusic++;
                            updateLoadingProgress();
                            resolve(null);
                        }, 15000); // 15ç§’è¶…æ—¶
                        
                        // ç›‘å¬éŸ³ä¹åŠ è½½äº‹ä»¶
                        const handleCanPlay = () => {
                            clearTimeout(timeout);
                            console.log(`éŸ³ä¹åŠ è½½æˆåŠŸ: ${music.title}`);
                            loadedMusic++;
                            updateLoadingProgress();
                            audio.removeEventListener('canplaythrough', handleCanPlay);
                            audio.removeEventListener('error', handleError);
                            audio.removeEventListener('loadeddata', handleLoadedData);
                            resolve(audio);
                        };
                        
                        const handleError = () => {
                            clearTimeout(timeout);
                            console.warn(`éŸ³ä¹åŠ è½½å¤±è´¥: ${music.title}`);
                            loadedMusic++;
                            updateLoadingProgress();
                            audio.removeEventListener('canplaythrough', handleCanPlay);
                            audio.removeEventListener('error', handleError);
                            audio.removeEventListener('loadeddata', handleLoadedData);
                            resolve(null); // å³ä½¿å¤±è´¥ä¹Ÿç»§ç»­
                        };
                        
                        const handleLoadedData = () => {
                            clearTimeout(timeout);
                            console.log(`éŸ³ä¹æ•°æ®åŠ è½½æˆåŠŸ: ${music.title}`);
                            loadedMusic++;
                            updateLoadingProgress();
                            audio.removeEventListener('canplaythrough', handleCanPlay);
                            audio.removeEventListener('error', handleError);
                            audio.removeEventListener('loadeddata', handleLoadedData);
                            resolve(audio);
                        };
                        
                        audio.addEventListener('canplaythrough', handleCanPlay);
                        audio.addEventListener('error', handleError);
                        audio.addEventListener('loadeddata', handleLoadedData);
                        
                        // å°è¯•åŠ è½½éŸ³ä¹
                        try {
                            audio.load();
                        } catch (e) {
                            console.warn(`éŸ³ä¹åŠ è½½å‡ºé”™: ${music.title}`, e);
                            clearTimeout(timeout);
                            loadedMusic++;
                            updateLoadingProgress();
                            resolve(null);
                        }
                    } else {
                        console.warn(`æ‰¾ä¸åˆ°éŸ³ä¹å…ƒç´ : ${music.id}`);
                        loadedMusic++;
                        updateLoadingProgress();
                        resolve(null);
                    }
                });
            });
            return Promise.all(promises);
        }

        // æ›´æ–°åŠ è½½è¿›åº¦
        function updateLoadingProgress() {
            const totalProgress = ((loadedImages + loadedMusic) / (totalImages + totalMusic)) * 100;
            
            console.log(`æ›´æ–°è¿›åº¦: å›¾ç‰‡ ${loadedImages}/${totalImages}, éŸ³ä¹ ${loadedMusic}/${totalMusic}, æ€»è®¡ ${Math.round(totalProgress)}%`);
            
            // æ›´æ–°è¿›åº¦æ¡
            progressBar.style.width = `${totalProgress}%`;
            progressText.textContent = `${Math.round(totalProgress)}%`;
            
            // æ›´æ–°è¯¦ç»†è¿›åº¦
            imageProgress.textContent = `${loadedImages}/${totalImages}`;
            musicProgress.textContent = `${loadedMusic}/${totalMusic}`;
            
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰èµ„æºéƒ½åŠ è½½å®Œæˆ
            if (loadedImages >= totalImages && loadedMusic >= totalMusic && !isAllResourcesLoaded) {
                console.log('æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆï¼Œå‡†å¤‡æ˜¾ç¤ºå®Œæˆç•Œé¢');
                isAllResourcesLoaded = true;
                showLoadingComplete();
            }
        }

        // æ˜¾ç¤ºåŠ è½½å®Œæˆæç¤º
        function showLoadingComplete() {
            console.log('æ˜¾ç¤ºåŠ è½½å®Œæˆæç¤º');
            const progressText = document.getElementById('progress-text');
            progressText.textContent = '100%';
            progressText.nextElementSibling.textContent = 'åŠ è½½å®Œæˆï¼';
            
            // æ·»åŠ å®ŒæˆåŠ¨ç”»
            const heart = document.querySelector('.loading-heart');
            heart.style.animation = 'loadingHeartbeat 0.5s ease-in-out 3';
            
            setTimeout(() => {
                hideLoadingScreen();
            }, 1500); // å»¶è¿Ÿ1.5ç§’è®©ç”¨æˆ·çœ‹åˆ°å®ŒæˆçŠ¶æ€
        }

        // éšè—åŠ è½½ç•Œé¢
        function hideLoadingScreen() {
            console.log('éšè—åŠ è½½ç•Œé¢ï¼Œå¼€å§‹æ¸¸æˆ');
            loadingScreen.style.opacity = '0';
            loadingScreen.style.transform = 'scale(0.95)';
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                // å¼€å§‹æ¸¸æˆ
                initGame();
            }, 300);
        }

        // æ˜¾ç¤ºéŸ³ä¹æç¤º
        function showMusicTip() {
            if (hasShownMusicTip) return;
            
            const tip = document.createElement('div');
            tip.className = 'fixed top-32 right-20 z-50 bg-gradient-to-r from-love-pink to-love-purple text-white px-4 py-2 rounded-full shadow-lg font-medium text-sm animate-bounce';
            tip.innerHTML = 'ğŸµ ç‚¹å‡»æ’­æ”¾æµªæ¼«èƒŒæ™¯éŸ³ä¹ ğŸµ';
            tip.style.animation = 'bounce 2s infinite';
            
            document.body.appendChild(tip);
            
            // 3ç§’åè‡ªåŠ¨éšè—æç¤º
            setTimeout(() => {
                tip.style.opacity = '0';
                tip.style.transform = 'translateY(-20px)';
                setTimeout(() => tip.remove(), 300);
            }, 3000);
            
            hasShownMusicTip = true;
        }

        // åˆå§‹åŒ–éŸ³ä¹æ§åˆ¶
        function initMusicControls() {
            // åˆå§‹åŒ–éŸ³ä¹åˆ—è¡¨
            musicList.forEach((music, index) => {
                music.element = document.getElementById(music.id);
                music.element.volume = volumeSlider.value / 100;
                
                // æ·»åŠ éŸ³ä¹æ’­æ”¾çŠ¶æ€ç›‘å¬å™¨
                music.element.addEventListener('play', () => {
                    if (index === currentMusicIndex) {
                        musicToggleBtn.innerHTML = '<i class="fa fa-pause"></i>';
                        musicToggleBtn.classList.add('playing');
                        document.querySelector('.music-player').classList.add('playing');
                        isMusicPlaying = true;
                    }
                });
                
                music.element.addEventListener('pause', () => {
                    if (index === currentMusicIndex) {
                        musicToggleBtn.innerHTML = '<i class="fa fa-play"></i>';
                        musicToggleBtn.classList.remove('playing');
                        document.querySelector('.music-player').classList.remove('playing');
                        isMusicPlaying = false;
                    }
                });
                
                music.element.addEventListener('ended', () => {
                    if (index === currentMusicIndex && isMusicPlaying) {
                        // éŸ³ä¹æ’­æ”¾ç»“æŸåè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€é¦–
                        nextMusic();
                    }
                });
            });

            musicToggleBtn.addEventListener('click', toggleMusic);
            musicNextBtn.addEventListener('click', nextMusic);
            volumeSlider.addEventListener('input', updateVolume);
            
            toggleMusic();
            // è®¾ç½®åˆå§‹éŸ³é‡
            updateVolume();
            
            // è‡ªåŠ¨æ’­æ”¾éŸ³ä¹ï¼ˆéœ€è¦ç”¨æˆ·äº¤äº’ï¼‰
            document.addEventListener('click', function() {
                if (isMusicPlaying && musicList[currentMusicIndex].element.paused) {
                    musicList[currentMusicIndex].element.play().catch(e => console.log('è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', e));
                }
            }, { once: true });
            
            updateMusicIcon();
            updateMusicTitle();
        }

        // åˆ‡æ¢éŸ³ä¹æ’­æ”¾çŠ¶æ€
        function toggleMusic() {
            const currentMusic = musicList[currentMusicIndex].element;
            const musicPlayer = document.querySelector('.music-player');
            
            if (isMusicPlaying) {
                currentMusic.pause();
                musicToggleBtn.innerHTML = '<i class="fa fa-play"></i>';
                musicToggleBtn.classList.remove('playing');
                musicPlayer.classList.remove('playing');
            } else {
                currentMusic.play().catch(e => console.log('æ’­æ”¾å¤±è´¥:', e));
                musicToggleBtn.innerHTML = '<i class="fa fa-pause"></i>';
                musicToggleBtn.classList.add('playing');
                musicPlayer.classList.add('playing');
            }
            isMusicPlaying = !isMusicPlaying;
        }

        // åˆ‡æ¢åˆ°ä¸‹ä¸€é¦–éŸ³ä¹
        function nextMusic() {
            // åœæ­¢å½“å‰éŸ³ä¹
            const currentMusic = musicList[currentMusicIndex].element;
            currentMusic.pause();
            currentMusic.currentTime = 0;
            
            // åˆ‡æ¢åˆ°ä¸‹ä¸€é¦–
            currentMusicIndex = (currentMusicIndex + 1) % musicList.length;
            
            // å¦‚æœæ­£åœ¨æ’­æ”¾ï¼Œè‡ªåŠ¨æ’­æ”¾æ–°éŸ³ä¹
            if (isMusicPlaying) {
                const newMusic = musicList[currentMusicIndex].element;
                newMusic.play().catch(e => console.log('æ’­æ”¾å¤±è´¥:', e));
            }
            
            updateMusicTitle();
        }

        // æ›´æ–°éŸ³é‡
        function updateVolume() {
            const volume = volumeSlider.value / 100;
            
            // æ›´æ–°æ‰€æœ‰éŸ³ä¹çš„éŸ³é‡
            musicList.forEach(music => {
                if (music.element) {
                    music.element.volume = volume;
                }
            });
            
            updateVolumeIcon(volume);
        }

        // æ›´æ–°éŸ³é‡å›¾æ ‡
        function updateVolumeIcon(volume = null) {
            if (volume === null) {
                volume = musicList[currentMusicIndex].element.volume;
            }
            
            const volumeIcon = document.querySelector('.volume-control i');
            if (volume > 0.5) {
                volumeIcon.className = 'fa fa-volume-up text-love-pink text-sm';
            } else if (volume > 0) {
                volumeIcon.className = 'fa fa-volume-down text-love-pink text-sm';
            } else {
                volumeIcon.className = 'fa fa-volume-off text-love-pink text-sm';
            }
        }

        // æ›´æ–°éŸ³ä¹æ ‡é¢˜
        function updateMusicTitle() {
            musicTitle.textContent = musicList[currentMusicIndex].title;
        }

        // åˆå§‹åŒ–è¿›åº¦æŒ‡ç¤ºå™¨
        function initProgressIndicators() {
            progressContainer.innerHTML = '';
            for (let i = 0; i < gameState.requiredScore; i++) {
                const indicator = document.createElement('div');
                indicator.className = 'w-4 h-4 rounded-full border-2 border-love-pink/50';
                indicator.id = `indicator-${i}`;
                progressContainer.appendChild(indicator);
            }
        }

        // åˆ›å»ºéšæœºæ˜Ÿæ˜ŸèƒŒæ™¯
        function createStars() {
            const starCount = 50;
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                const size = Math.random() * 3 + 1;
                const left = Math.random() * 100;
                const top = Math.random() * 100;
                const opacity = Math.random() * 0.8 + 0.2;
                const delay = Math.random() * 5;
                
                star.className = 'absolute rounded-full bg-white animate-pulse';
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${left}%`;
                star.style.top = `${top}%`;
                star.style.opacity = opacity;
                star.style.animationDelay = `${delay}s`;
                
                starsContainer.appendChild(star);
            }
        }

        // åˆ›å»ºçˆ±å¿ƒå…ƒç´ 
        function createHeart() {
            if (!gameState.isPlaying) return;
            
            const heart = document.createElement('div');
            const size = Math.random() * 30 + 20; // 20-50px
            const left = Math.random() * (heartsContainer.offsetWidth - size);
            const color = ['text-love-pink', 'text-love-red', 'text-love-purple', 'text-love-blue'][Math.floor(Math.random() * 4)];
            
            heart.className = `heart ${color} glow`;
            heart.innerHTML = '<i class="fa fa-heart"></i>';
            heart.style.fontSize = `${size}px`;
            heart.style.left = `${left}px`;
            heart.style.top = `-${size}px`;
            
            // éšæœºåŠ¨ç”»æŒç»­æ—¶é—´å’Œæ—‹è½¬
            const duration = Math.random() * 4 + 3; // 3-7ç§’
            const rotation = Math.random() * 40 - 20; // -20åˆ°20åº¦
            
            heart.dataset.speed = (Math.random() * 2 + 1).toString(); // 1-3çš„é€Ÿåº¦å› å­
            heart.dataset.rotation = rotation.toString();
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            heart.addEventListener('click', () => handleHeartClick(heart));
            
            heartsContainer.appendChild(heart);
            
            // å­˜å‚¨çˆ±å¿ƒæ•°æ®
            gameState.hearts.push({
                element: heart,
                y: -size,
                rotation: rotation,
                speed: parseFloat(heart.dataset.speed)
            });
        }

        // 7ç§ç¥ç¦è¯­
        const blessings = [
            "ä½ æœ€ç¾",
            "é•¿é•¿ä¹…ä¹…",
            "å…±åŒè¿›æ­¥",
            "æƒ³ä½ å“¦",
            "æœ€æ£’çš„",
            "ä¸€èµ·åŠ æ²¹",
            "å¹¸ç¦å¿«ä¹"
        ];

        // å¤„ç†çˆ±å¿ƒç‚¹å‡»
        function handleHeartClick(heartElement) {
            if (!gameState.isPlaying) return;
            
            // æ‰¾åˆ°å¯¹åº”çš„çˆ±å¿ƒæ•°æ®å¹¶ç§»é™¤
            const index = gameState.hearts.findIndex(h => h.element === heartElement);
            if (index !== -1) {
                gameState.hearts.splice(index, 1);
            }
            
            // è·å–ç‚¹å‡»ä½ç½®
            const rect = heartElement.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            
            // åˆ›å»ºçƒŸèŠ±æ•ˆæœ
            createFirework(x, y, heartElement.classList.contains('text-love-pink') ? '#FF6B8B' : 
                          heartElement.classList.contains('text-love-red') ? '#FF3366' :
                          heartElement.classList.contains('text-love-purple') ? '#C955E8' : '#6A8FFF');
            
            // éšæœºæ˜¾ç¤ºç¥ç¦è¯­
            showRandomBlessing(x, y);
            
            // ç§»é™¤çˆ±å¿ƒå…ƒç´ 
            heartElement.remove();
            
            // æ›´æ–°åˆ†æ•°
            gameState.score++;
            updateGameProgress();
            
            // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç›®æ ‡
            if (gameState.score >= gameState.requiredScore) {
                endGame();
            }
        }
        
        // ç¥ç¦è¯­ä¸é‡å¤éšæœºé€‰æ‹©
        let usedBlessings = [];
        
        // æ˜¾ç¤ºéšæœºç¥ç¦è¯­
        function showRandomBlessing(x, y) {
            let blessing;
            
            // å¦‚æœæ‰€æœ‰ç¥ç¦è¯­éƒ½ç”¨è¿‡äº†ï¼Œé‡æ–°å¼€å§‹
            if (usedBlessings.length >= blessings.length) {
                usedBlessings = [];
            }
            
            // ä»æœªä½¿ç”¨çš„ç¥ç¦è¯­ä¸­éšæœºé€‰æ‹©
            const availableBlessings = blessings.filter(b => !usedBlessings.includes(b));
            blessing = availableBlessings[Math.floor(Math.random() * availableBlessings.length)];
            
            // æ ‡è®°ä¸ºå·²ä½¿ç”¨
            usedBlessings.push(blessing);
            
            // åˆ›å»ºç¥ç¦è¯­å…ƒç´ 
            const blessingElement = document.createElement('div');
            blessingElement.className = 'fixed z-50 pointer-events-none text-center';
            blessingElement.style.left = `${x}px`;
            blessingElement.style.top = `${y}px`;
            blessingElement.style.transform = 'translate(-50%, -50%)';
            
            // è®¾ç½®ç¥ç¦è¯­æ ·å¼
            blessingElement.innerHTML = `
                <div class="bg-gradient-to-r from-love-pink to-love-purple text-white px-4 py-2 rounded-full shadow-lg font-romantic text-lg font-bold">
                    ${blessing}
                </div>
            `;
            
            document.body.appendChild(blessingElement);
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            blessingElement.style.animation = 'blessingFloat 2s ease-out forwards';
            
            // 2ç§’åç§»é™¤å…ƒç´ 
            setTimeout(() => {
                blessingElement.remove();
            }, 2000);
        }

        // åˆ›å»ºçƒŸèŠ±æ•ˆæœ
        function createFirework(x, y, color) {
            const firework = document.createElement('div');
            firework.className = 'firework';
            firework.style.left = `${x}px`;
            firework.style.top = `${y}px`;
            document.body.appendChild(firework);
            
            const particleCount = 30;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'firework-particle';
                
                // éšæœºç²’å­å¤§å°
                const size = Math.random() * 4 + 2;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // éšæœºé¢œè‰²ï¼ŒåŸºäºçˆ±å¿ƒé¢œè‰²çš„å˜ä½“
                particle.style.backgroundColor = color;
                
                // éšæœºæ–¹å‘å’Œè·ç¦»
                const angle = (i / particleCount) * Math.PI * 2;
                const distance = Math.random() * 60 + 30;
                
                // è®¡ç®—ç»ˆç‚¹ä½ç½®
                const endX = Math.cos(angle) * distance;
                const endY = Math.sin(angle) * distance;
                
                // è®¾ç½®åˆå§‹ä½ç½®
                particle.style.transform = 'translate(0, 0)';
                
                firework.appendChild(particle);
                
                // åŠ¨ç”»æ•ˆæœ
                setTimeout(() => {
                    particle.style.transition = 'all 0.6s cubic-bezier(0.1, 0.8, 0.9, 1)';
                    particle.style.transform = `translate(${endX}px, ${endY}px)`;
                    particle.style.opacity = '0';
                }, 10);
            }
            
            // æ¸…ç†çƒŸèŠ±å…ƒç´ 
            setTimeout(() => {
                firework.remove();
            }, 1000);
        }

        // æ›´æ–°æ¸¸æˆè¿›åº¦æŒ‡ç¤ºå™¨
        function updateGameProgress() {
            for (let i = 0; i < gameState.requiredScore; i++) {
                const indicator = document.getElementById(`indicator-${i}`);
                if (i < gameState.score) {
                    indicator.className = 'w-4 h-4 rounded-full bg-love-pink';
                } else {
                    indicator.className = 'w-4 h-4 rounded-full border-2 border-love-pink/50';
                }
            }
        }

        // åŠ¨ç”»å¾ªç¯ - è®©çˆ±å¿ƒä¸‹è½
        function animateHearts() {
            const containerHeight = heartsContainer.offsetHeight;
            
            // æ›´æ–°æ¯ä¸ªçˆ±å¿ƒçš„ä½ç½®
            gameState.hearts.forEach((heart, index) => {
                heart.y += heart.speed;
                heart.rotation += 0.5 * (heart.speed - 1); // æ—‹è½¬é€Ÿåº¦åŸºäºä¸‹è½é€Ÿåº¦
                
                heart.element.style.top = `${heart.y}px`;
                heart.element.style.transform = `rotate(${heart.rotation}deg)`;
                
                // ç§»é™¤è¶…å‡ºå®¹å™¨çš„çˆ±å¿ƒ
                if (heart.y > containerHeight + 50) {
                    heart.element.remove();
                    gameState.hearts.splice(index, 1);
                }
            });
            
            // ç»§ç»­åŠ¨ç”»å¾ªç¯
            gameState.animationFrameId = requestAnimationFrame(animateHearts);
        }

        // ç”Ÿæˆæ–°çˆ±å¿ƒçš„é—´éš”å‡½æ•°
        function spawnHearts() {
            if (gameState.isPlaying) {
                createHeart();
                // éšæœºé—´éš”ç”Ÿæˆæ–°çˆ±å¿ƒ
                setTimeout(spawnHearts, Math.random() * 1000 + 500);
            }
        }

        // ç»“æŸæ¸¸æˆå¹¶æ˜¾ç¤ºç¥ç¦
        function endGame() {
            gameState.isPlaying = false;
            
            // åœæ­¢æ‰€æœ‰åŠ¨ç”»
            if (gameState.animationFrameId) {
                cancelAnimationFrame(gameState.animationFrameId);
            }
            
            // ç§»é™¤æ‰€æœ‰å‰©ä½™çˆ±å¿ƒ
            gameState.hearts.forEach(heart => {
                heart.element.remove();
            });
            gameState.hearts = [];
            
            // æ˜¾ç¤ºç¥ç¦ä¿¡æ¯
            setTimeout(() => {
                message.style.opacity = '1';
                message.style.pointerEvents = 'auto';
                // è®©ä¿¡æ¯å¡ç‰‡æœ‰å¼¹å‡ºæ•ˆæœ
                const messageCard = message.querySelector('div');
                setTimeout(() => {
                    messageCard.classList.add('scale-100');
                    messageCard.classList.remove('scale-95');
                    // å¯åŠ¨å›¾ç‰‡è½®æ’­
                    startImageCarousel();
                }, 100);
            }, 1000);
        }

        // å›¾ç‰‡è½®æ’­åŠŸèƒ½
        let currentImageIndex = 0;
        let carouselInterval = null;
        
        function startImageCarousel() {
            const messageBg = document.querySelector('.message-bg');
            const dots = document.querySelectorAll('.carousel-dot');
            
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (carouselInterval) {
                clearInterval(carouselInterval);
            }
            
            // è®¾ç½®å®šæ—¶å™¨ï¼Œæ¯2ç§’åˆ‡æ¢ä¸€æ¬¡å›¾ç‰‡
            carouselInterval = setInterval(() => {
                currentImageIndex = (currentImageIndex + 1) % imageFiles.length;
                updateCarouselImage(currentImageIndex);
            }, 2000);
            
            // åˆå§‹åŒ–ç¬¬ä¸€å¼ å›¾ç‰‡
            updateCarouselImage(0);
        }
        
        function updateCarouselImage(index) {
            const messageBg = document.querySelector('.message-bg');
            const dots = document.querySelectorAll('.carousel-dot');
            
            // æ›´æ–°èƒŒæ™¯å›¾ç‰‡
            messageBg.style.backgroundImage = `url('${imageFiles[index]}')`;
            
            // æ›´æ–°æŒ‡ç¤ºå™¨çŠ¶æ€
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
            
            currentImageIndex = index;
        }
        
        // ä¸ºè½®æ’­æŒ‡ç¤ºå™¨æ·»åŠ ç‚¹å‡»äº‹ä»¶
        function initCarouselControls() {
            const dots = document.querySelectorAll('.carousel-dot');
            dots.forEach((dot, index) => {
                dot.addEventListener('click', () => {
                    // æ¸…é™¤è‡ªåŠ¨è½®æ’­
                    if (carouselInterval) {
                        clearInterval(carouselInterval);
                    }
                    
                    // åˆ‡æ¢åˆ°æŒ‡å®šå›¾ç‰‡
                    updateCarouselImage(index);
                    
                    // é‡æ–°å¼€å§‹è‡ªåŠ¨è½®æ’­
                    setTimeout(() => {
                        startImageCarousel();
                    }, 2000);
                });
            });
        }
        
        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.score = 0;
            gameState.isPlaying = true;
            
            // éšè—ç¥ç¦ä¿¡æ¯
            message.style.opacity = '0';
            message.style.pointerEvents = 'none';
            const messageCard = message.querySelector('div');
            messageCard.classList.remove('scale-100');
            messageCard.classList.add('scale-95');
            
            // åœæ­¢è½®æ’­
            if (carouselInterval) {
                clearInterval(carouselInterval);
                carouselInterval = null;
            }
            
            // é‡ç½®è¿›åº¦æŒ‡ç¤ºå™¨
            updateGameProgress();
            
            // é‡æ–°å¼€å§‹åŠ¨ç”»
            animateHearts();
            spawnHearts();
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            initProgressIndicators();
            createStars();
            updateGameProgress();
            
            // å¼€å§‹åŠ¨ç”»å’Œç”Ÿæˆçˆ±å¿ƒ
            animateHearts();
            spawnHearts();
            
            // ç»‘å®šé‡æ–°å¼€å§‹æŒ‰é’®äº‹ä»¶
            restartBtn.addEventListener('click', restartGame);
            
            // åˆå§‹åŒ–è½®æ’­æ§åˆ¶
            initCarouselControls();
            
            // åˆå§‹åŒ–éŸ³ä¹æ§åˆ¶
            initMusicControls();
            
            // æ˜¾ç¤ºéŸ³ä¹æç¤º
            showMusicTip();
            
            // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è®¡ç®—ä½ç½®
            window.addEventListener('resize', () => {
                // æ¸…é™¤ç°æœ‰çˆ±å¿ƒ
                gameState.hearts.forEach(heart => {
                    heart.element.remove();
                });
                gameState.hearts = [];
            });
        }

        // å¯åŠ¨æ¸¸æˆ
        window.addEventListener('load', () => {
            // ç»‘å®šè·³è¿‡åŠ è½½æŒ‰é’®
            skipLoadingBtn.addEventListener('click', () => {
                console.log('ç”¨æˆ·æ‰‹åŠ¨è·³è¿‡åŠ è½½');
                if (!isAllResourcesLoaded) {
                    // å¼ºåˆ¶è®¾ç½®æ‰€æœ‰èµ„æºä¸ºå·²åŠ è½½
                    loadedImages = totalImages;
                    loadedMusic = totalMusic;
                    updateLoadingProgress();
                    isAllResourcesLoaded = true;
                    showLoadingComplete();
                }
            });
            
            // å¼€å§‹åŠ è½½èµ„æº
            console.log('å¼€å§‹åŠ è½½èµ„æº...');
            
            // è®¾ç½®å…¨å±€åŠ è½½è¶…æ—¶ï¼ˆ30ç§’ï¼‰
            const loadingTimeout = setTimeout(() => {
                console.warn('åŠ è½½è¶…æ—¶ï¼Œå¼ºåˆ¶æ˜¾ç¤ºç•Œé¢');
                if (!isAllResourcesLoaded) {
                    isAllResourcesLoaded = true;
                    showLoadingComplete();
                }
            }, 30000);
            
            // è®¾ç½®å¼ºåˆ¶å®Œæˆå®šæ—¶å™¨ï¼ˆ10ç§’åå¼ºåˆ¶å®Œæˆï¼‰
            const forceCompleteTimeout = setTimeout(() => {
                console.warn('å¼ºåˆ¶å®ŒæˆåŠ è½½');
                if (!isAllResourcesLoaded) {
                    // å¼ºåˆ¶è®¾ç½®æ‰€æœ‰èµ„æºä¸ºå·²åŠ è½½
                    loadedImages = totalImages;
                    loadedMusic = totalMusic;
                    updateLoadingProgress();
                    isAllResourcesLoaded = true;
                    showLoadingComplete();
                }
            }, 10000);
            
            // å¹¶è¡ŒåŠ è½½å›¾ç‰‡å’ŒéŸ³ä¹
            Promise.all([
                preloadImages(),
                preloadMusic()
            ]).then(([images, music]) => {
                // æ¸…é™¤è¶…æ—¶å®šæ—¶å™¨
                clearTimeout(loadingTimeout);
                clearTimeout(forceCompleteTimeout);
                
                console.log('æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ');
                console.log('å›¾ç‰‡åŠ è½½:', images.filter(img => img !== null).length, '/', totalImages);
                console.log('éŸ³ä¹åŠ è½½:', music.filter(audio => audio !== null).length, '/', totalMusic);
                
                // èµ„æºåŠ è½½å®Œæˆï¼Œç•Œé¢ä¼šè‡ªåŠ¨æ˜¾ç¤º
                console.log('èµ„æºåŠ è½½å®Œæˆï¼Œç­‰å¾…ç•Œé¢æ˜¾ç¤º');
            }).catch(error => {
                // æ¸…é™¤è¶…æ—¶å®šæ—¶å™¨
                clearTimeout(loadingTimeout);
                clearTimeout(forceCompleteTimeout);
                
                console.error('èµ„æºåŠ è½½å‡ºé”™:', error);
                // å‡ºé”™æ—¶ä¹Ÿæ˜¾ç¤ºç•Œé¢
                setTimeout(() => {
                    if (!isAllResourcesLoaded) {
                        isAllResourcesLoaded = true;
                        showLoadingComplete();
                    }
                }, 2000);
            });
        });
    </script>
</body>
</html>
    